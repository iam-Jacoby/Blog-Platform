{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-body">
        <h1 class="card-title">{{ post.title }}</h1>
        <p class="card-subtitle text-muted mb-2">
            by <a href="{% url 'user_profile' post.author.username %}">{{ post.author.username }}</a>
            on {{ post.created_at|date:"F j, Y" }}
        </p>
        <hr>
        <div class="card-text">
            {{ post.content|safe }}
        </div>

        <hr>
        <h4 class="mt-4">Comments ({{ comments.count }})</h4>

        {% for comment in comments %}
            <div class="mb-3 p-2 bg-white border rounded">
                <strong>{{ comment.author.username }}</strong>
                <span class="text-muted small">on {{ comment.created_at|date:"F j, Y, g:i a" }}</span>
                <p class="mt-1">{{ comment.content }}</p>
            </div>
        {% empty %}
            <p class="text-muted">No comments yet.</p>
        {% endfor %}

        {% if user.is_authenticated %}
            {% if form.errors %}
                <div class="alert alert-danger">
                    <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <form method="post" class="mt-4">
                {% csrf_token %}
                
                {% if form.errors %}
                    <div class="alert alert-danger">
                        <ul>
                        {% for field in form %}
                            {% for error in field.errors %}
                                <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                <div class="mb-3">
                    <label for="id_content" class="form-label">Comment</label>
                    <textarea name="content" id="id_content" rows="4" class="form-control" placeholder="Write a comment...">{{ form.content.value }}</textarea>
                </div>

                <button type="submit" class="btn btn-primary">Post Comment</button>
            </form>

        {% else %}
            <p><a href="{% url 'login' %}">Login</a> to leave a comment.</p>
        {% endif %}

        {% if post.tags.all %}
            <div class="mt-3">
                <strong>Tags:</strong>
                {% for tag in post.tags.all %}
                    <a class="badge bg-secondary text-decoration-none" href="{% url 'tagged_posts' tag.slug %}">#{{ tag.name }}</a>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    {% if user == post.author %}
    <div class="card-footer">
        <a href="{% url 'post_edit' post.pk %}" class="btn btn-outline-primary btn-sm">‚úèÔ∏è Edit</a>
        <a href="{% url 'post_delete' post.pk %}" class="btn btn-outline-danger btn-sm">üóëÔ∏è Delete</a>
    </div>
    {% endif %}
</div>

<a href="{% url 'blog_list' %}" class="btn btn-outline-secondary">‚Üê Back to all posts</a>
{% endblock %}
